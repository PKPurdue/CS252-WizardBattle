<html>
	<head>
		<title>Wizard Battle</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	</head>
	<body id="body" style="background-color: #000;">
		<div id="chooseNameDiv" style="display: none;">
			<br>
			<br>
			<p class="centerText" style="font-size: 25px;"><b>Welcome to Wizard Battle!</b></p>
			<br>
			<br>
			<p class="centerText" style="font-size: 18px;">Choose a Name</p>
			<input class="nameBox" placeholder="Enter your player name here"></input>
			<p class="centerText" id="nameError" style="margin: 0px; font-size: 16px; color: #F33; display: none;">Error: </p>
			<br>
			<br>
			<button class="serverButton" onclick="verifyName()">Play</button>
			<br>
			<br>
		</div>
		
		<div id="serverList" style="display: none;">
			<div class="card-columns" id="serverCardHolder">
				<div id="serverExample" class="card" style="display: none;">
				  <div class="card-body">
					<h5 class="card-title">Server Title</h5>
					<p class="card-text">10/10 players</p>
					<a id="gameId:-1" class="btn btn-primary" onclick="joinServer(this)">Join</a>
				  </div>
				</div>
			</div>
			<button id="createServerButton" data-toggle="modal" data-target="#exampleModal">Create Game</button>
		</div>
		
		<div id="serverLobby" style="display: none;">
			<br>
			<p id="serverPlayerCount" class="centerText" style="font-size: 25px;"><b>1/10 Players</b></p>
			<br>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<div id="playerExample" class="playerTag" style="display: none;">
				<p class="playerName">Player Name</p>
				<div class="playerStatus">Host</div>
			</div>
			<p> </p>
			<button id="startGameButton" onclick="startGame()">Start Game</button>
		</div>
		
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">New Game</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				  <span aria-hidden="true">&times;</span>
				</button>
			  </div>
			  <div class="modal-body">
				<form>
				  <div class="form-group">
					<label for="recipient-name" class="col-form-label">Server Name:</label>
					<input type="text" class="form-control" id="createServerName">
				  </div>
				</form>
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button id="sendMessageButton" type="button" class="btn btn-primary" onclick="createGame()" data-dismiss="modal">Create Game</button>
			  </div>
			</div>
		  </div>
		</div>
		
		<div id="wizardBattleGame" style="display: block;">
			<img src="images/Map.png" style="position: absolute; width: 100%; height: 100%"></img>
			<div id="playerIconContainer" style="position: absolute;" >
				<img src="images/Potion.png" style="width: 50px; height: 50px;"></img>
				<p class="" style="position: relative;"><i>Player Name Here</i></p>
			</div>
		</div>
		
		<!-- Socket stuff -->
		<script src="js/jquery.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="js/main.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		<!--<script> 
			var socket = io();
			var socket_id;

			//BEGGINING STUFF
			function showSignupPage()
			{
				document.getElementsByClassName("signupResponse")[0].innerHTML = "";
				document.getElementById("lobby_div").style.display = "none";
				document.getElementById("init_div").style.display = "none";
				document.getElementById("signup_div").style.display = "block";
			}
			
			function signup()
			{
				var userN = document.getElementById("signupUsername").value;
				var passW = document.getElementById("signupPassword").value;
				console.log("Username: " + userN + ", Password: " + passW);
				socket.emit('signup', {username: userN, password: passW});
			}
			
			socket.on('signupResponse', function(data)
			{
				if (data.success == true)
				{
					document.getElementById("lobby_div").style.display = "none";
					document.getElementById("init_div").style.display = "block";
					document.getElementById("signup_div").style.display = "none";
					document.getElementsByClassName("welcomeHeader")[0].innerHTML = "Welcome " + document.getElementById("signupUsername").value;
				}
				else
				{
					document.getElementsByClassName("signupResponse")[0].innerHTML = data.state;
					console.log("Failed to login");
				}
			});
			
			function login() 
			{
				var userN = document.getElementById("usernameInput").value;
				var passW = document.getElementById("passwordInput").value;
				console.log("Username: " + userN + ", Password: " + passW);
				socket.emit('login', {username: userN, password: passW});
			}
			

			socket.on('loginResponse', function(data) 
			{
				if (data.success == true)
				{

					document.getElementById("lobby_div").style.display = "block";
					document.getElementById("init_div").style.display = "none";
					document.getElementById("signup_div").style.display = "none";
					socket_id = data.socketId;
				}
				else
				{
					document.getElementsByClassName("loginResponse")[0].innerHTML = data.state;
					console.log("Failed to login");
				}
			});
			function signOut() 
			{
				socket.emit('logout', {});
				console.log("Attempting to logout");
			}
			
			socket.on('logoutResponse', function(data)
			{
				if (data.success == true)
				{
					document.getElementById("signupUsername").value = "";
					document.getElementById("signupPassword").value = "";
					document.getElementById("usernameInput").value = "";
					document.getElementById("passwordInput").value = "";
					document.getElementsByClassName("loginResponse")[0].innerHTML = "";
					document.getElementById("game_lobby_div").style.display = "none";
					document.getElementById("lobby_div").style.display = "none";
					document.getElementById("init_div").style.display = "block";
					document.getElementById("signup_div").style.display = "none";
				}
				else { console.log("Failed to logout"); }
			});
			
			/* ############ LOBBY STUFF ################# */
			//for updating the games list
			socket.on('getCreatedGamesResponse', function(data) {
				var games = data.games;
				for (var i = 0; i < games.length; i++)
				{
					//binds game id to button for join game
					var button = "b" + i;
					document.getElementById(button).setAttribute("gameId", games[i].id);
					//console.log(document.getElementById(button).getAttribute("gameId"));
					var name = "Server " + i;
					document.getElementById(name).style.display = "block";
					var playerCountText = "pc_" + i;
					document.getElementById(playerCountText).innerHTML = games[i].numPlayers + " Players";
					//console.log(games[i].id);
				}
			});
			//for updating the player list
			socket.on('getPlayersInGameResponse', function(data) {
				var players = data.players;
				for (var i = 0;i < players.length; i++) {
					//start game button 
					//THIS NEEDS COOKIES ENABLED TO TOGGLE START GAME BUTTON
					//player name
					var pname = "pname " + i;
					document.getElementById(pname).innerHTML = players[i].name;
					//host or player
					var pstatus = "status " + i;
					document.getElementById(pstatus).innerHTML = players[i].hosting;
					//update what player number
					var pid = "Player " + i;
					document.getElementById(pid).style.display = "block";
				}
			});
			function joinGame(buttonId) {
				var gameid = document.getElementById(buttonId).getAttribute("gameId");
				socket.emit('joinGame', {gameId: gameid});
			}
			
			socket.on('joinGameResponse', function(data) {
				if (data.success == true) {
					document.getElementById("game_lobby_div").style.display = "block";
					document.getElementById("lobby_div").style.display = "none";
				} else {
					console.log("Failed to join game");
				}
			});
			function createGame()
			{
				socket.emit('createGame', {});
			}
			
			socket.on('createGameResponse', function(data) {
				if (data.success == true) {
					document.getElementById("lobby_div").style.display = "none";
					//document.getElementById("game_lobby_div").setAttribute("gameId", data.gameId);
					document.getElementById("game_lobby_div").style.display = "block";
				} else {
					document.getElementsByClassName("createGame")[0].innerHTML = data.state;
					console.log("Failed to login");
				}
			});
			function startGame() {
				socket.emit('startGame', {});
			}
			/*
			socket.on('startGameResponse', function(data) {
				if (data.success == true) {
					document.getElementById("game_lobby_div").style.display = "none";
					document.getElementById("ctx").style.display = "block";
				} else {
					console.log("Failed to start game");
				}
			});*/
			
			//GAME STUFF

			//Players
			var p0 = new Image();
			p0.src = "images/Plane1.png";

			var p1 = new Image();
			p1.src = "images/Plane2.png";

			var p2 = new Image();
			p2.src = "images/Plane3.png";

			var p3 = new Image();
			p3.src = "images/Plane1.png";

			var all_p = [];
			//all_p.push(document.getElementById("p0"));
			all_p.push(p0);
			all_p.push(p1);
			all_p.push(p2);
			all_p.push(p3);

			//Bullets
			var b_switch = 0;
			var b_offset;
			var all_b = [];
			for (var z=0;z<5000;z++) {
				var b = new Image();
				b.src = "images/Bullet2.png";
				all_b.push(b);
			}

			//Enemies
			var e_switch = 0;
			var e_offset;
			var all_e = [];
			for (var x=0;x<1000;x++) {
				var e = new Image();
				e.src = "images/Jet1.png";
				all_e.push(e);
			}

			var ctx = document.getElementById("ctx").getContext("2d");
			ctx.font = '30px Arial';
			socket.on('positionUpdate', function(data){
				document.getElementById("game_lobby_div").style.display = "none";
				document.getElementById("body").style.backgroundImage = "none";
				document.getElementById("canvas").style.display = "block";
				document.getElementById("map").style.display = "block";
				//console.log("The new x position is " + data.x);
				//console.log("\nThe new y position is " + data.y);
				pos = data.objectPositions;
				//console.log("this: " + pos.name);
				ctx.clearRect(0,0,1845,945);
				//ctx.drawImage(p0, 100, 100, 50, 50);
				for (var i=0;i<pos.length;i++) {
					if (pos[i].className == "Player") {
						console.log("Player: " + i);
						ctx.save();
						ctx.translate(pos[i].x, pos[i].y);
						ctx.rotate(pos[i].rotation*Math.PI/180);
						ctx.drawImage(all_p[i], -25, -25, 50, 50);
						ctx.restore();
					} 

					if (pos[i].className == "Bullet" && b_switch == 0) {
						b_switch = 1;
						b_offset = i;
					}

					if (pos[i].className == "Bullet") {
						ctx.save();
						ctx.translate(pos[i].x, pos[i].y);
						ctx.rotate((pos[i].rotation+90)*Math.PI/180);
						ctx.drawImage(all_b[i-b_offset], -5, -5, 10, 10);
						ctx.restore();
					}

					if (pos[i].className == "Enemy" && e_switch == 0) {
						e_switch = 1;
						e_offset = i;
					}

					if (pos[i].className == "Enemy") {
						ctx.save();
						ctx.translate(pos[i].x, pos[i].y);
						ctx.rotate((pos[i].rotation)*Math.PI/180);
						ctx.drawImage(all_e[i-e_offset], -25, -25, 50, 50);
						ctx.restore();
					}
				}
				/*
				for (var i = 0;i<data.length;i++) {
					ctx.fillText(data[i].number,data[i].x,data[i].y);
				}*/
			});
			
			//when key is pressed send signal to server
			document.onkeydown = function(event) {
				if (event.keyCode === 68) { 
					//d
					socket.emit('keyPress', {inputId:'right',state:true,socketid: socket_id});
				} else if (event.keyCode === 83) {
					//s
					socket.emit('keyPress', {inputId:'down',state:true,socketid: socket_id});
				} else if (event.keyCode === 65) {
					//a
					socket.emit('keyPress', {inputId:'left',state:true,socketid: socket_id});
				} else if (event.keyCode === 87) {
					//w
					socket.emit('keyPress', {inputId:'up',state:true,socketid: socket_id});
				} else if (event.keyCode === 13) {
					//enter
					socket.emit('keyPress', {inputId:'fire',state:true,socketid: socket_id});
				}
			}
			//when key is released send signal to server
			document.onkeyup = function(event) {
				if (event.keyCode === 68) { 
					//d
					socket.emit('keyPress', {inputId:'right',state:false,socketid: socket_id});
				} else if (event.keyCode === 83) {
					//s
					socket.emit('keyPress', {inputId:'down',state:false,socketid: socket_id});
				} else if (event.keyCode === 65) {
					//a
					socket.emit('keyPress', {inputId:'left',state:false,socketid: socket_id});
				} else if (event.keyCode === 87) {
					//w
					socket.emit('keyPress', {inputId:'up',state:false,socketid: socket_id});
				} else if (event.keyCode === 13) {
					//enter
					socket.emit('keyPress', {inputId:'fire',state:false,socketid: socket_id});
				}
			}
		</script>-->
	</body>
</html>